<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟DOM | React学习指南</title>
    <meta name="description" content="我的React.js学习笔记与源码讲解">
    <link rel="icon" href="/react.js-learn/favicon.png">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/react.js-learn/assets/css/0.styles.05b14ba7.css" as="style"><link rel="preload" href="/react.js-learn/assets/js/app.150168e2.js" as="script"><link rel="preload" href="/react.js-learn/assets/js/6.9bf269cb.js" as="script"><link rel="prefetch" href="/react.js-learn/assets/js/10.a7621cc4.js"><link rel="prefetch" href="/react.js-learn/assets/js/11.dfae7c78.js"><link rel="prefetch" href="/react.js-learn/assets/js/2.a550b4a4.js"><link rel="prefetch" href="/react.js-learn/assets/js/3.b06ab81b.js"><link rel="prefetch" href="/react.js-learn/assets/js/4.ea85da10.js"><link rel="prefetch" href="/react.js-learn/assets/js/5.81d71556.js"><link rel="prefetch" href="/react.js-learn/assets/js/7.d124dbee.js"><link rel="prefetch" href="/react.js-learn/assets/js/8.66d6ba11.js"><link rel="prefetch" href="/react.js-learn/assets/js/9.5493bfb8.js">
    <link rel="stylesheet" href="/react.js-learn/assets/css/0.styles.05b14ba7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/react.js-learn/" class="home-link router-link-active"><!----> <span class="site-name">React学习指南</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/AqingCyan/react.js-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/AqingCyan/react.js-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>基础知识点</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/react.js-learn/book/01.从TodoList开始.html" class="sidebar-link">从TodoList开始</a></li><li><a href="/react.js-learn/book/02.todolist的细节补充.html" class="sidebar-link">Todo还有这些细节</a></li><li><a href="/react.js-learn/book/03.虚拟DOM.html" class="active sidebar-link">虚拟DOM是什么</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react.js-learn/book/03.虚拟DOM.html#假设，我们自己完成-dom-的重新渲染，该如何去做呢？" class="sidebar-link">假设，我们自己完成 DOM 的重新渲染，该如何去做呢？</a></li><li class="sidebar-sub-header"><a href="/react.js-learn/book/03.虚拟DOM.html#另一种做法" class="sidebar-link">另一种做法</a></li><li class="sidebar-sub-header"><a href="/react.js-learn/book/03.虚拟DOM.html#react-的做法" class="sidebar-link">React 的做法</a></li><li class="sidebar-sub-header"><a href="/react.js-learn/book/03.虚拟DOM.html#真实项目比对" class="sidebar-link">真实项目比对</a></li><li class="sidebar-sub-header"><a href="/react.js-learn/book/03.虚拟DOM.html#虚拟-dom-带来的好处" class="sidebar-link">虚拟 DOM 带来的好处</a></li></ul></li><li><a href="/react.js-learn/book/04.虚拟DOM的Diff算法.html" class="sidebar-link">Diff算法提升性能</a></li><li><a href="/react.js-learn/book/05.生命周期.html" class="sidebar-link">生命周期了解</a></li><li><a href="/react.js-learn/book/06.Redux的初步了解.html" class="sidebar-link">Redux如何管理数据</a></li><li><a href="/react.js-learn/book/07.如何用Redux重构todo.html" class="sidebar-link">使用Redux来重构Todo</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="虚拟dom"><a href="#虚拟dom" aria-hidden="true" class="header-anchor">#</a> 虚拟DOM</h1> <blockquote><p>我们在写 TodoList 的时候，响应式数据的原理是：当组件的 state 或者 props 发生改变的时候，render 函数就会重新执行。但我们知道，重新渲染对性能消耗极大。所以这里就引入了虚拟 DOM 的概念。</p></blockquote> <h2 id="假设，我们自己完成-dom-的重新渲染，该如何去做呢？"><a href="#假设，我们自己完成-dom-的重新渲染，该如何去做呢？" aria-hidden="true" class="header-anchor">#</a> 假设，我们自己完成 DOM 的重新渲染，该如何去做呢？</h2> <ul><li>定义一个 state，让页面拥有数据</li> <li>定义一个 JSX 模板，以便 render 函数渲染</li> <li>把数据与模板结合生成真实的 DOM 来显示</li> <li>一旦 state 发生改变</li> <li>数据与模板结合生成真实的 DOM，替换原始的 DOM
<blockquote><p>致命缺陷：第一次生成了一个完成的 DOM 片段，第二次又生成了一个完整的 DOM 片段，然后第二次的 DOM 替换第一的 DOM，非常耗费性能。</p></blockquote></li></ul> <h2 id="另一种做法"><a href="#另一种做法" aria-hidden="true" class="header-anchor">#</a> 另一种做法</h2> <ul><li>定义一个 state，让页面拥有数据</li> <li>定义一个 JSX 模板，以便 render 函数渲染</li> <li>把数据与模板结合生成真实的 DOM 来显示</li> <li>一旦 state 发生改变</li> <li>数据与模板结合生成真实的 DOM，并不替换原始的 DOM</li> <li>新的 DOM（DocumentFragment）和原始的 DOM 做比对，找差异</li> <li>找出 input 框发生了变化</li> <li>只用新的 DOM 中的 input 元素，替换掉老的 DOM 中的 input 元素
<blockquote><p>缺陷：虽然替换的性能减去了，但比对的性能损耗也较大，性能的提升并不明显。</p></blockquote></li></ul> <h2 id="react-的做法"><a href="#react-的做法" aria-hidden="true" class="header-anchor">#</a> React 的做法</h2> <ul><li>定义一个 state，让页面拥有数据</li> <li>定义一个 JSX 模板，以便 render 函数渲染</li> <li>把数据与模板结合生成虚拟 DOM（虚拟 DOM 就是一个 JS 对象，用它来描述真实的 DOM）</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">;</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;abc&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">[</span>
  <span class="token comment">// 虚拟DOM描述</span>
  <span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">&quot;abc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>用虚拟 DOM 的结构生成真实的 DOM 来显示</li> <li>state 发生变化</li> <li>生成新的虚拟 DOM</li> <li>比较原始虚拟 DOM 与新的虚拟 DOM 的区别</li> <li>直接操作 DOM 改变变化的内容
<blockquote><p>虚拟 DOM 的本质是 JS 对象，JS 对象的比对比直接比对真实的 DOM 消耗的性能小很多。</p></blockquote></li></ul> <h2 id="真实项目比对"><a href="#真实项目比对" aria-hidden="true" class="header-anchor">#</a> 真实项目比对</h2> <p>在我们写的 TodoList 中，子组件 TodoItem 中 render 函数中 return 的内容我们做一个简单的修改，只让显示 item。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        item
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>当我们用 React 更底层的一个 api，<code>React.createELement</code>来创建元素。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>发现之前实现的效果是一样的。</p> <ul><li>JSX -&gt; createElement -&gt; 虚拟 DOM（JS 对象） -&gt; 真实的 DOM</li> <li>我们发现，实际上 JSX 语法只是与 html 相似，实际上并不是真正的 html。它只是方便我们创建虚拟 DOM。</li></ul> <h2 id="虚拟-dom-带来的好处"><a href="#虚拟-dom-带来的好处" aria-hidden="true" class="header-anchor">#</a> 虚拟 DOM 带来的好处</h2> <ul><li>性能提升了：DOM 比对变成了虚拟 DOM 的比对</li> <li>使得跨端应用的实现：ReactNative，不是直接生成 DOM（原生应用没有 DOM 这个概念），而是可以基于虚拟 DOM 转化成原生应用。</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/AqingCyan/react.js-learn/edit/master/book/03.虚拟DOM.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">8/13/2019, 2:44:56 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/react.js-learn/assets/js/app.150168e2.js" defer></script><script src="/react.js-learn/assets/js/6.9bf269cb.js" defer></script>
  </body>
</html>
